<!DOCTYPE html>
<html lang="en">
  <head>
    {% load static %}
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dofa | Authentication</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 15px;
        transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        flex-direction: column;
      }

      /* Login mode - White background with blue bordered bubbles */
      body.login-mode {
        background: white;
      }

      /* Signup mode - Blue gradient background with solid bubbles */
      body.signup-mode {
        background: linear-gradient(135deg, #01015d 0%, #234581 100%);
      }

      /* Background animation bubbles for the entire screen */
      .screen-animation {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        pointer-events: none;
        z-index: 0;
      }

      .screen-bubble {
        position: absolute;
        border-radius: 50%;
        animation: floatScreenBubble 12s ease-in-out infinite;
        opacity: 0.4;
      }

      /* Login mode screen bubbles - blue borders only */
      .login-mode .screen-bubble {
        background: transparent;
        border: 3px solid rgba(42, 82, 152, 0.15);
        backdrop-filter: blur(8px);
      }

      /* Signup mode screen bubbles - solid white/transparent */
      .signup-mode .screen-bubble {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .screen-bubble:nth-child(1) {
        width: 120px;
        height: 120px;
        top: 5%;
        left: 8%;
        animation-delay: -2s;
      }

      .screen-bubble:nth-child(2) {
        width: 80px;
        height: 80px;
        top: 75%;
        right: 10%;
        animation-delay: -4s;
      }

      .screen-bubble:nth-child(3) {
        width: 150px;
        height: 150px;
        top: 40%;
        left: 75%;
        animation-delay: -1s;
      }

      .screen-bubble:nth-child(4) {
        width: 60px;
        height: 60px;
        top: 15%;
        right: 30%;
        animation-delay: -3s;
      }

      .screen-bubble:nth-child(5) {
        width: 100px;
        height: 100px;
        bottom: 15%;
        left: 15%;
        animation-delay: -5s;
      }

      .screen-bubble:nth-child(6) {
        width: 70px;
        height: 70px;
        top: 60%;
        left: 5%;
        animation-delay: -6s;
      }

      .screen-bubble:nth-child(7) {
        width: 90px;
        height: 90px;
        bottom: 40%;
        right: 20%;
        animation-delay: -7s;
      }

      @keyframes floatScreenBubble {
        0%,
        100% {
          transform: translateY(0) translateX(0) rotate(0deg) scale(1);
          opacity: 0.4;
        }
        25% {
          transform: translateY(-50px) translateX(30px) rotate(90deg) scale(1.2);
          opacity: 0.6;
        }
        50% {
          transform: translateY(-20px) translateX(-25px) rotate(180deg)
            scale(0.8);
          opacity: 0.3;
        }
        75% {
          transform: translateY(-60px) translateX(20px) rotate(270deg)
            scale(1.1);
          opacity: 0.5;
        }
      }

      .auth-container {
        background: white;
        border-radius: 25px;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        overflow: hidden;
        width: 100%;
        max-width: 420px;
        position: relative;
        transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        min-height: 650px;
        z-index: 1;
      }

      /* Login Background - White with blue bordered bubbles */
      .auth-container.login-mode {
        background: white;
        box-shadow: 0 25px 50px rgba(42, 82, 152, 0.15);
      }

      /* Signup Background - Blue with solid bubbles */
      .auth-container.signup-mode {
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
      }

      /* Animated Background Bubbles inside form container */
      .background-animation {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        pointer-events: none;
        z-index: 1;
      }

      .bubble {
        position: absolute;
        border-radius: 50%;
        animation: floatBubble 8s ease-in-out infinite;
        opacity: 0.6;
      }

      /* Login mode bubbles - blue borders only */
      .login-mode .bubble {
        background: transparent;
        border: 2px solid rgba(42, 82, 152, 0.2);
        backdrop-filter: blur(5px);
      }

      /* Signup mode bubbles - solid white/transparent */
      .signup-mode .bubble {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(10px);
      }

      .bubble:nth-child(1) {
        width: 80px;
        height: 80px;
        top: 10%;
        left: 10%;
        animation-delay: -2s;
      }

      .bubble:nth-child(2) {
        width: 60px;
        height: 60px;
        top: 70%;
        right: 15%;
        animation-delay: -4s;
      }

      .bubble:nth-child(3) {
        width: 100px;
        height: 100px;
        top: 50%;
        left: 70%;
        animation-delay: -1s;
      }

      .bubble:nth-child(4) {
        width: 40px;
        height: 40px;
        top: 30%;
        right: 25%;
        animation-delay: -3s;
      }

      .bubble:nth-child(5) {
        width: 70px;
        height: 70px;
        bottom: 20%;
        left: 20%;
        animation-delay: -5s;
      }

      .bubble:nth-child(6) {
        width: 50px;
        height: 50px;
        top: 80%;
        left: 60%;
        animation-delay: -6s;
      }

      @keyframes floatBubble {
        0%,
        100% {
          transform: translateY(0) translateX(0) rotate(0deg) scale(1);
          opacity: 0.6;
        }
        25% {
          transform: translateY(-30px) translateX(20px) rotate(90deg) scale(1.1);
          opacity: 0.8;
        }
        50% {
          transform: translateY(-10px) translateX(-15px) rotate(180deg)
            scale(0.9);
          opacity: 0.4;
        }
        75% {
          transform: translateY(-40px) translateX(10px) rotate(270deg)
            scale(1.05);
          opacity: 0.7;
        }
      }

      .form-header {
        padding: 35px 30px 25px;
        text-align: center;
        position: relative;
        z-index: 2;
      }

      .login-mode .form-header {
        color: #1e3c72;
      }

      .signup-mode .form-header {
        color: white;
      }

      h1 {
        font-size: 2.2rem;
        font-weight: 700;
        margin-bottom: 8px;
        transition: all 0.4s ease;
      }

      .subtitle {
        opacity: 0.85;
        font-size: 1rem;
        margin-bottom: 25px;
        transition: all 0.4s ease;
      }

      .form-toggle {
        display: flex;
        background: rgba(42, 82, 152, 0.1);
        border-radius: 50px;
        padding: 4px;
        backdrop-filter: blur(15px);
        position: relative;
        overflow: hidden;
        margin-bottom: 5px;
      }

      .signup-mode .form-toggle {
        background: rgba(255, 255, 255, 0.15);
      }

      .toggle-slider {
        position: absolute;
        top: 4px;
        left: 4px;
        width: calc(50% - 4px);
        height: calc(100% - 8px);
        background: #2a5298;
        border-radius: 50px;
        transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .toggle-slider.signup {
        transform: translateX(100%);
      }

      .signup-mode .toggle-slider {
        background: white;
      }

      .form-toggle button {
        flex: 1;
        padding: 12px 24px;
        border: none;
        background: transparent;
        color: #2a5298;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
        position: relative;
        z-index: 2;
      }

      .signup-mode .form-toggle button {
        color: white;
      }

      .form-toggle button.active {
        color: white;
      }

      .signup-mode .form-toggle button.active {
        color: #2a5298;
      }

      .form-body {
        padding: 0 30px 35px;
        position: relative;
        z-index: 2;
      }

      .form {
        position: relative;
        transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        opacity: 1;
        transform: translateX(0);
      }

      .form.hidden {
        opacity: 0;
        transform: translateX(-50px);
        pointer-events: none;
        position: absolute;
        top: 0;
        left: 30px;
        right: 30px;
      }

      .form-group {
        margin-bottom: 20px;
        position: relative;
      }

      .form-group input {
        width: 100%;
        padding: 16px 22px;
        border: 2px solid rgba(42, 82, 152, 0.2);
        border-radius: 15px;
        font-size: 1rem;
        transition: all 0.3s ease;
        font-weight: 500;
        backdrop-filter: blur(10px);
      }

      /* Login mode inputs - white background with blue styling */
      .login-mode .form-group input {
        background: rgba(42, 82, 152, 0.05);
        border-color: rgba(42, 82, 152, 0.2);
        color: #1e3c72;
      }

      .login-mode .form-group input::placeholder {
        color: rgba(30, 60, 114, 0.7);
      }

      .login-mode .form-group input:focus {
        border-color: #2a5298;
        background: rgba(42, 82, 152, 0.1);
        box-shadow: 0 8px 25px rgba(42, 82, 152, 0.15);
      }

      /* Signup mode inputs - transparent with white styling */
      .signup-mode .form-group input {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(255, 255, 255, 0.3);
        color: white;
      }

      .signup-mode .form-group input::placeholder {
        color: rgba(255, 255, 255, 0.8);
      }

      .signup-mode .form-group input:focus {
        border-color: rgba(255, 255, 255, 0.8);
        background: rgba(255, 255, 255, 0.25);
        box-shadow: 0 8px 25px rgba(255, 255, 255, 0.1);
      }

      .form-group input:focus {
        outline: none;
        transform: translateY(-2px);
      }

      .btn-primary {
        width: 100%;
        padding: 16px;
        border: none;
        border-radius: 15px;
        color: white;
        font-size: 1.1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-top: 15px;
        position: relative;
        overflow: hidden;
      }

      /* Login mode button - blue gradient */
      .login-mode .btn-primary {
        background: linear-gradient(45deg, #2a5298, #1e3c72);
        box-shadow: 0 8px 25px rgba(42, 82, 152, 0.3);
      }

      .login-mode .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 35px rgba(42, 82, 152, 0.4);
      }

      /* Signup mode button - purple gradient */
      .signup-mode .btn-primary {
        background: linear-gradient(45deg, #667eea, #0a3d74);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
      }

      .signup-mode .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
      }

      .btn-primary::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s;
      }

      .btn-primary:hover::before {
        left: 100%;
      }

      .switch-text {
        text-align: center;
        margin-top: 20px;
        font-size: 0.95rem;
        transition: all 0.3s ease;
      }

      .login-mode .switch-text {
        color: #64748b;
      }

      .signup-mode .switch-text {
        color: rgba(255, 255, 255, 0.8);
      }

      .switch-text a {
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
      }

      .login-mode .switch-text a {
        color: #2a5298;
      }

      .login-mode .switch-text a:hover {
        color: #1e3c72;
      }

      .signup-mode .switch-text a {
        color: white;
      }

      .signup-mode .switch-text a:hover {
        color: #667eea;
      }

      /* Responsive Design */
      @media (max-width: 480px) {
        .auth-container {
          max-width: 350px;
          min-height: max-content;
        }

        .form-header {
          padding: 25px 20px 0px;
        }

        .form-body {
          padding: 0 20px 25px;
        }

        .form.hidden {
          left: 20px;
          right: 20px;
        }

        h1 {
          font-size: 1.9rem;
        }

        .form-group {
          margin-bottom: 18px;
        }

        .form-group input {
          padding: 14px 18px;
        }

        .btn-primary {
          padding: 14px;
          margin-top: 10px;
        }
      }

      @media (max-width: 380px) {
        .auth-container {
          max-width: 320px;
          min-height: 580px;
        }

        h1 {
          font-size: 1.7rem;
        }

        .subtitle {
          font-size: 0.9rem;
        }

        .form-group {
          margin-bottom: 16px;
        }
      }

      /* Loading animation */
      .btn-primary.loading::after {
        content: "";
        position: absolute;
        width: 16px;
        height: 16px;
        margin: auto;
        border: 2px solid transparent;
        border-top-color: #ffffff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      @keyframes spin {
        0% {
          transform: translate(-50%, -50%) rotate(0deg);
        }
        100% {
          transform: translate(-50%, -50%) rotate(360deg);
        }
      }
    </style>
  </head>
  <body class="login-mode" id="bodyElement">
    <!-- Screen-wide background animation -->
    <div class="screen-animation">
      <div class="screen-bubble"></div>
      <div class="screen-bubble"></div>
      <div class="screen-bubble"></div>
      <div class="screen-bubble"></div>
      <div class="screen-bubble"></div>
      <div class="screen-bubble"></div>
      <div class="screen-bubble"></div>
    </div>
    <img
      src="{% static 'assets/MAIN-LOGO.png' %}"
      alt="Logo"
      style="width: 500px; object-fit: contain; display: block"
    />

    <div class="auth-container login-mode" id="authContainer">
      <!-- Animated Background Bubbles -->
      <div class="background-animation">
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
      </div>

      <div class="form-header">
        <h1 id="formTitle">Welcome Back</h1>
        <p class="subtitle" id="formSubtitle">Sign in to your account</p>

        <!-- <div class="form-toggle">
          <div class="toggle-slider" id="toggleSlider"></div>
          <button
            type="button"
            id="loginToggle"
            class="active"
            onclick="switchToLogin()"
          >
            Login
          </button>
          <button type="button" id="signupToggle" onclick="switchToSignup()">
            Signup
          </button>
        </div> -->
      </div>

      <div class="form-body">
        <!-- LOGIN FORM -->
        <form class="form login-form" id="loginForm" method="post">
          {% csrf_token %}
          <div class="form-group">
            <input
              type="text"
              id="login-username"
              name="username"
              placeholder="Username"
              required
            />
          </div>
          <div class="form-group">
            <input
              type="password"
              id="login-password"
              name="password"
              placeholder="Password"
              required
            />
          </div>
          <button type="submit" class="btn-primary" id="login-btn">
            Login
          </button>
          <div class="switch-text">
            Don't have an account?
            <a onclick="switchToSignup()">Sign up here</a>
          </div>
        </form>

        <!-- SIGNUP FORM -->
        <form class="form signup-form hidden" id="signupForm" method="post">
          {% csrf_token %}
          <div class="form-group">
            <input
              type="text"
              id="full_name"
              placeholder="Full Name"
              required
            />
          </div>
          <div class="form-group">
            <input type="text" id="user_name" placeholder="Username" required />
          </div>
          <div class="form-group">
            <input
              type="email"
              id="email"
              placeholder="Email Address"
              required
            />
          </div>
          <div class="form-group">
            <input
              type="number"
              id="phone-number"
              placeholder="Phone Number"
              required
            />
          </div>
          <div class="form-group">
            <input
              type="password"
              id="password"
              placeholder="Password"
              required
            />
          </div>
          <p class="switch-text">
            <input type="checkbox" id="termsCheck" required /> Agree with
            <a href="#">Terms & Conditions</a>
          </p>
          <button type="submit" class="btn-primary">Sign Up</button>
          <div class="switch-text">
            Already have an account? <a onclick="switchToLogin()">Login here</a>
          </div>
        </form>
      </div>
    </div>

    <script>
      document
        .getElementById("signupForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const fullName = document.getElementById("full_name").value.trim();
          const userName = document.getElementById("user_name").value.trim();
          const password = document.getElementById("password").value.trim();
          const email = document.getElementById("email").value.trim();
          const phone = document.getElementById("phone-number").value.trim();
          const terms = document.getElementById("termsCheck").checked;

          if (
            !fullName ||
            !userName ||
            !password ||
            !email ||
            !phone ||
            !terms
          ) {
            alert("Please fill all fields and agree to terms.");
            return;
          }

          try {
            const res = await fetch("/api/signup/", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                full_name: fullName,
                user_name: userName,
                password,
                email,
                phone_number: phone,
              }),
            });
            const data = await res.json();
            if (data.success) {
              // store token for OTP verification
              localStorage.setItem("signup_token", data.token); // store token, not email
              alert("OTP generated! Check console (or email if enabled).");
              window.location.href = '{% url "signup-page" %}';
            } else {
              alert("Error: " + data.message);
            }
          } catch (err) {
            console.error(err);
            alert("Something went wrong.");
          }
        });

      function switchToLogin() {
        const bodyElement = document.getElementById("bodyElement");
        const authContainer = document.getElementById("authContainer");
        const loginForm = document.getElementById("loginForm");
        const signupForm = document.getElementById("signupForm");
        const loginToggle = document.getElementById("loginToggle");
        const signupToggle = document.getElementById("signupToggle");
        const toggleSlider = document.getElementById("toggleSlider");
        const formTitle = document.getElementById("formTitle");
        const formSubtitle = document.getElementById("formSubtitle");

        // Change body and container background mode
        bodyElement.className = "login-mode";
        authContainer.className = "auth-container login-mode";

        // Hide signup form
        signupForm.classList.add("hidden");

        // Show login form after a short delay
        setTimeout(() => {
          loginForm.classList.remove("hidden");
        }, 200);

        // Update toggle states
        loginToggle.classList.add("active");
        signupToggle.classList.remove("active");
        toggleSlider.classList.remove("signup");

        // Update header text
        formTitle.textContent = "Welcome Back";
        formSubtitle.textContent = "Sign in to your account";
      }

      function switchToSignup() {
        const bodyElement = document.getElementById("bodyElement");
        const authContainer = document.getElementById("authContainer");
        const loginForm = document.getElementById("loginForm");
        const signupForm = document.getElementById("signupForm");
        const loginToggle = document.getElementById("loginToggle");
        const signupToggle = document.getElementById("signupToggle");
        const toggleSlider = document.getElementById("toggleSlider");
        const formTitle = document.getElementById("formTitle");
        const formSubtitle = document.getElementById("formSubtitle");

        // Change body and container background mode
        bodyElement.className = "login-mode";
        authContainer.className = "auth-container signup-mode";

        // Hide login form
        loginForm.classList.add("hidden");

        // Show signup form after a short delay
        setTimeout(() => {
          signupForm.classList.remove("hidden");
        }, 200);

        // Update toggle states
        signupToggle.classList.add("active");
        loginToggle.classList.remove("active");
        toggleSlider.classList.add("signup");

        // Update header text
        formTitle.textContent = "Join Us Today";
        formSubtitle.textContent = "Create your new account";
      }

      // Enhanced input interactions
      document.querySelectorAll("input").forEach((input) => {
        input.addEventListener("focus", function () {
          this.parentElement.style.transform = "translateY(-2px)";
        });

        input.addEventListener("blur", function () {
          this.parentElement.style.transform = "translateY(0)";
        });

        // Real-time validation feedback
        input.addEventListener("input", function () {
          if (this.validity.valid && this.value.length > 0) {
            this.style.borderColor = "#10b981";
          } else if (this.value.length > 0) {
            this.style.borderColor = "#ef4444";
          } else {
            // Reset to default based on current mode
            const isLoginMode = document
              .getElementById("authContainer")
              .classList.contains("login-mode");
            this.style.borderColor = isLoginMode
              ? "rgba(42, 82, 152, 0.2)"
              : "rgba(255, 255, 255, 0.3)";
          }
        });
      });

      // Form submission with loading state
      document.querySelectorAll("form").forEach((form) => {
        form.addEventListener("submit", function (e) {
          const button = this.querySelector(".btn-primary");
          button.classList.add("loading");
          button.style.pointerEvents = "none";

          // Remove loading state after form submission
          setTimeout(() => {
            button.classList.remove("loading");
            button.style.pointerEvents = "auto";
          }, 3000);
        });
      });
      document
        .getElementById("loginForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const username = document
            .getElementById("login-username")
            .value.trim();
          const password = document
            .getElementById("login-password")
            .value.trim();

          if (!username || !password) {
            alert("Please enter both username and password.");
            return;
          }

          const loginButton = document.getElementById("login-btn");
          loginButton.classList.add("loading");
          loginButton.style.pointerEvents = "none";

          try {
            const res = await fetch("/api/login/", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ username, password }),
            });

            const data = await res.json();

            if (res.ok && data.success) {
              // Redirect user to the home page
              window.location.href = data.redirect_url || "/home/";
            } else {
              alert(data.message || "Invalid credentials");
            }
          } catch (err) {
            console.error(err);
            alert("Something went wrong. Please try again.");
          } finally {
            loginButton.classList.remove("loading");
            loginButton.style.pointerEvents = "auto";
          }
        });
      function setRealVH() {
        let vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty("--vh", `${vh}px`);
      }
      window.addEventListener("resize", setRealVH);
      window.addEventListener("load", setRealVH);
    </script>
  </body>
</html>
